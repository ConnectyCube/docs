---
title: Authentication and Users
description: Simplify user authentication in your Android app with our definitive API guide. Fortify your app's defenses and protect user data effectively.
head:
  - tag: title
    content: Android Authentication and Users APIs | ConnectyCube
sidebar:
  label: Authentication and Users
  order: 3
---

import { Tabs, TabItem } from "@astrojs/starlight/components";

Every user needs to authenticate with ConnectyCube before using any ConnectyCube functionality.

When someone connects with an application using ConnectyCube, the application will need to obtain a session token which provides temporary secure access to ConnectyCube APIs.

A session token is an opaque string that identifies a user and an application.




## Create session token

As a starting point, the user’s session token needs to be created allowing user any further actions within the app. Pass login/email and password to identify a user:

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val userToLogin = ConnectycubeUser(login = "marvin18", password = "supersecurepwd")
ConnectyCube.signIn(userToLogin, { user -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val user = ConnectycubeUser().apply {
    login = "marvin18"
    password = "supersecurepwd"
}

ConnectycubeUsers.signIn(user).performAsync(object : EntityCallback<ConnectycubeUser> {
override fun onSuccess(user: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
final ConnectycubeUser user = new ConnectycubeUser();
user.setLogin("marvin18");
user.setPassword("supersecurepwd");

ConnectycubeUsers.signIn(user).performAsync(new EntityCallback<ConnectycubeUser>() {
    @Override
    public void onSuccess(ConnectycubeUser user, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

**Note:** With the request above, __the user is created automatically on the fly upon session creation__ using the login (or email) and password from the request parameters.


<div style={{
  fontSize: "0.75em",
  color: "#666",
  backgroundColor: "#f0f4ff",
  borderLeft: "4px solid #ccc",
  paddingLeft: "10px",
  marginTop: "20px"
}}>

  <strong>Important:</strong> For better security it is recommended to deny the session creation without an existing user.    
  For this, set ‘Session creation without an existing user entity’ to **Deny** under the **Application -> Overview -> Permissions** in the [admin panel](https://admin.connectycube.com/apps). 
</div>



## Authentication via phone number

Sign In with phone number is supported with **Firebase integration**.

The whole guide on how to create Firebase project, connect Firebase SDK and implement authentication via phone number is available at our [Firebase Setup Guide](/android/firebase-setup-guide). Please follow it.

## Authentication via external identity provider

**Custom Identity Provider (CIdP)** feature is necessary if you have your own user database and want to authenticate users in ConnectyCube against it. It works the same way as Facebook/Twitter SSO.

With Custom Identity Provider feature you can continue use your user database instead of storing/copying user data to ConnectyCube database.

### CIdP high level integration flow

To get started with **CIdP** integration, check the [Custom Identity Provider guide](/guides/custom-identity-provider) which describes high level integration flow.

### How to login via CIdP

Once you done with the setup mapping in ConnectyCube Dashboard, it's time to verify the integration.
To perform CIdP login, the same ConnectyCube [User Login API](/android/authentication-and-users/#upgrade-session-token-user-login) is used. You just use existing login request params to pass your external user token: 

```kotlin
val userToLogin = ConnectycubeUser(login = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTIzNDU2Nzg5LCJuYW1lIjoiSm9zZXBoIn0.OpOSSw7e485LOP5PrzScxHb7SR6sAOMRckfFwi4rp7o")
ConnectyCube.signIn(userToLogin, { user -> }, { error -> })
```

Once the login is successful, ConnectyCube will create an underalying User entity, so then you can use ConnectyCube APIs in a same way as you do with a normal login. With CIdP we do not have/store any user password in ConnectyCube User entity.

Following further integration, you may need to connect to Chat. In a case of CIdP login, you do not have a user password. In such cases you should use ConnectyCube session token as a password for chat connection. [Follow the Connect to Chat with CIdP guide](/android/messaging/#connect-to-chat-using-custom-authentication-providers).

## Session expiration

Expiration time for session token is 2 hours after the last request to API is made. But you do not need to worry about it - with the automatic session token management it will be renewed automatically with next request to API.

## Destroy session token

To destroy a session use the following code:

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.destroySession({ }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeAuth.deleteSession().performAsync(object : EntityCallback<Void?> {
    override fun onSuccess(result: Void?, params: Bundle) {

    }

    override fun onError(responseException: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeAuth.deleteSession().performAsync(new EntityCallback<Void>() {
    @Override
    public void onSuccess(Void result, Bundle params) {

    }

    @Override
    public void onError(ResponseException responseException) {

    }
});
````

</TabItem>
</Tabs>

## User signup

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val userTags = listOf("iphone", "apple")
            
val userToSignUp = ConnectycubeUser(login = "marvin18", password = "supersecurepwd").apply {
    email = "awesomeman@gmail.com"
    fullName = "Marvin Simon"
    phone = "47802323143"
    website = "https://dozensofdreams.com"
    tags = userTags.joinToString(",")
}

ConnectyCube.signUp(userToSignUp, { user -> }, { error -> })

````

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val userTags = StringifyArrayList<String>().apply {
    add("iphone")
    add("apple")
}

val user = ConnectycubeUser("marvin18", "supersecurepwd").apply {
    login = "marvin18"
    password = "supersecurepwd"
    email = "awesomeman@gmail.com"
    fullName = "Marvin Simon"
    phone = "47802323143"
    website = "https://dozensofdreams.com"
    tags = userTags
}

ConnectycubeUsers.signUp(user).performAsync(object : EntityCallback<ConnectycubeUser> {
    override fun onSuccess(user: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }
})
````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
final ConnectycubeUser user = new ConnectycubeUser("marvin18", "supersecurepwd");
user.setLogin("marvin18");
user.setPassword("supersecurepwd");
user.setEmail("awesomeman@gmail.com");
user.setFullName("Marvin Simon");
user.setPhone("47802323143");
user.setWebsite("https://dozensofdreams.com");
StringifyArrayList<String> tags = new StringifyArrayList<String>();
tags.add("iphone");
tags.add("apple");
user.setTags(tags);

ConnectycubeUsers.signUp(user).performAsync(new EntityCallback<ConnectycubeUser>() {
@Override
public void onSuccess(ConnectycubeUser user, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }

});

````

</TabItem>
</Tabs>

Only login (or email) + password are required. Other fields are optional.

## User profile update

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val userToUpdate = ConnectycubeUser(login = "marvin18", password = "supersecurepwd")
ConnectyCube.updateUser(userToUpdate, { user -> }, { error -> })
````

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val user = ConnectycubeUser().apply {
    login = "marvin18"
    fullName = "Marvin Simon"
}

ConnectycubeUsers.updateUser(user).performAsync(object : EntityCallback<ConnectycubeUser> {
override fun onSuccess(user: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUser user = new ConnectycubeUser();
user.setLogin("marvin18");
user.setFullName("Marvin Simon");

ConnectycubeUsers.updateUser(user).performAsync(new EntityCallback<ConnectycubeUser>() {
    @Override
    public void onSuccess(ConnectycubeUser user, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

If you want to change your password, you need to provide 2 parameters: `password` and `oldPassword`. An updated `user` entity will be returned.

## User avatar

You can set a user's avatar. You just need to upload it to the ConnectyCube cloud storage and then connect to user.

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val imageFile: File = ...
ConnectyCube.uploadFile(imageFile.path, successCallback = { cubeFile ->
    val jo = JsonObject()
    jo.add("avatar_uid", JsonPrimitive(cubeFile.uid))
    user.customData = jo.toString()

    ConnectyCube.updateUser(user, { user -> }, { error -> })

}, errorCallback = { ex -> })

````

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val imageFile: File = ...
ConnectycubeStorage.uploadFileTask(imageFile, false, null).performAsync(object: EntityCallback<ConnectycubeFile> {
    override fun  onSuccess(connectycubeFile: ConnectycubeFile, params: Bundle) {
        val jo = JsonObject()
        jo.add("avatar_uid", JsonPrimitive(connectycubeFile.uid))
        user.customData = jo.toString()

        ConnectycubeUsers.updateUser(user).performAsync(...)
    }

    override fun onError(responseException: ResponseException) {

    }
})
````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
File imageFile = ...
ConnectycubeStorage.uploadFileTask(imageFile, false, null).performAsync(new EntityCallback<ConnectycubeFile>() {
    @Override
    public void onSuccess(ConnectycubeFile connectycubeFile, Bundle params) {
        JsonObject jo = new JsonObject();
        jo.add("avatar_uid", new JsonPrimitive(connectycubeFile.getUid()));
        user.setCustomData(jo.toString());

        ConnectycubeUsers.updateUser(user).performAsync(...);
    }

    @Override
    public void onError(ResponseException responseException) {

    }

});

````

</TabItem>
</Tabs>

Now, other users can get you avatar:

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val obj = JsonParser().parse(user.customData).asJsonObject
val fileUID = obj.getAsJsonPrimitive("avatar_uid").asString
val avatarUrl = getPrivateUrlForUID(fileUID)
````

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val obj = JsonParser().parse(user.customData).asJsonObject
val fileUID = obj.getAsJsonPrimitive("avatar_uid").asString
val avatarUrl = ConnectycubeFile.getPrivateUrlForUID(fileUID)
```

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
JsonObject obj = new JsonParser().parse(user.getCustomData()).getAsJsonObject();
String fileUID = obj.getAsJsonPrimitive("avatar_uid").getAsString();
String avatarUrl = ConnectycubeFile.getPrivateUrlForUID(fileUID);
```

</TabItem>
</Tabs>

## Password reset

It's possible to reset a password via email:

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.resetPassword("awesomeman@gmail.com", {}, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeUsers.resetPassword("awesomeman@gmail.com").performAsync(object : EntityCallback<Void?> {
    override fun onSuccess(result: Void?, params: Bundle) {

    }

    override fun onError(responseException: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUsers.resetPassword("awesomeman@gmail.com").performAsync(new EntityCallback<Void>() {
    @Override
    public void onSuccess(Void result, Bundle params) {

    }

    @Override
    public void onError(ResponseException responseException) {

    }
});
````

</TabItem>
If provided email is valid - an email with password reset instruction will be sent to it.

</Tabs>

## Retrieve users

### Retrieve users by ID

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val usersIds = setOf(22, 23)
ConnectyCube.getUsersByIds(usersIds, {usersResult -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val pagedRequestBuilder = PagedRequestBuilder().apply {
    page = 1
    perPage = 50
}

val usersIds: MutableList<Int> = ArrayList<Int>().apply {
add(22)
add(23)
}

val params = Bundle()

ConnectycubeUsers.getUsersByIDs(usersIds, pagedRequestBuilder, params).performAsync(object : EntityCallback<ArrayList<ConnectycubeUser>> {
override fun onSuccess(users: ArrayList<ConnectycubeUser>, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
PagedRequestBuilder pagedRequestBuilder = new PagedRequestBuilder();
pagedRequestBuilder.setPage(1);
pagedRequestBuilder.setPerPage(50);

List<Integer> usersIds = new ArrayList<>();
usersIds.add(22);
usersIds.add(23);

Bundle params = new Bundle();

ConnectycubeUsers.getUsersByIDs(usersIds, pagedRequestBuilder, params).performAsync(new EntityCallback<ArrayList<ConnectycubeUser>>() {
    @Override
    public void onSuccess(ArrayList<ConnectycubeUser> users, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve user by login

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.getUserByLogin("amigo", {user -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeUsers.getUserByLogin("amigo").performAsync(object : EntityCallback<ConnectycubeUser> {
    override fun onSuccess(user: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUsers.getUserByLogin("amigo").performAsync(new EntityCallback<ConnectycubeUser>() {
    @Override
    public void onSuccess(ConnectycubeUser user, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve user by email

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.getUserByEmail("amigo@gmail.com", {user -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeUsers.getUserByEmail("amigo@gmail.com").performAsync(object : EntityCallback<ConnectycubeUser> {
    override fun onSuccess(user: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUsers.getUserByEmail("amigo@gmail.com").performAsync(new EntityCallback<ConnectycubeUser>() {
    @Override
    public void onSuccess(ConnectycubeUser user, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve users by full name

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.getUsersByFullName("Marvin Samuel", {usersResult -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val pagedRequestBuilder = PagedRequestBuilder().apply {
    page = 1
    perPage = 50
}

val params = Bundle()

ConnectycubeUsers.getUsersByFullName("Marvin Samuel", pagedRequestBuilder, params)
.performAsync(object : EntityCallback<ArrayList<ConnectycubeUser>> {
override fun onSuccess(users: ArrayList<ConnectycubeUser>, args: Bundle) {

        }

        override fun onError(error: ResponseException) {

        }
    })

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
PagedRequestBuilder pagedRequestBuilder = new PagedRequestBuilder();
pagedRequestBuilder.setPage(1);
pagedRequestBuilder.setPerPage(50);

Bundle params = new Bundle();

ConnectycubeUsers.getUsersByFullName("Marvin Samuel", pagedRequestBuilder, params).performAsync(new EntityCallback<ArrayList<ConnectycubeUser>>() {
    @Override
    public void onSuccess(ArrayList<ConnectycubeUser> users, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve user by phone number

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.getUserByPhoneNumber("+4427123314", {user -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val pagedRequestBuilder = PagedRequestBuilder().apply {
    page = 1
    perPage = 50
}

val usersPhones: ArrayList<String> = ArrayList<String>().apply {
add("+4427123314")
}

val params = Bundle()

ConnectycubeUsers.getUsersByPhoneNumbers(usersPhones, pagedRequestBuilder, params)
.performAsync(object : EntityCallback<ArrayList<ConnectycubeUser>> {
override fun onSuccess(users: ArrayList<ConnectycubeUser>, args: Bundle) {

        }

        override fun onError(error: ResponseException) {

        }
    })

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
PagedRequestBuilder pagedRequestBuilder = new PagedRequestBuilder();
pagedRequestBuilder.setPage(1);
pagedRequestBuilder.setPerPage(50);

Bundle params = new Bundle();

ArrayList<String> usersPhones = new ArrayList<>();
usersPhones.add("+4427123314");

ConnectycubeUsers.getUsersByPhoneNumbers(usersPhones, pagedRequestBuilder, params).performAsync(new EntityCallback<ArrayList<ConnectycubeUser>>() {
    @Override
    public void onSuccess(ArrayList<ConnectycubeUser> users, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve user by external ID

<Tabs syncKey="codeExamples">
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeUsers.getUserByExternalId("3789").performAsync(object : EntityCallback<ConnectycubeUser> {
    override fun onSuccess(users: ConnectycubeUser, args: Bundle) {

    }

    override fun onError(error: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUsers.getUserByExternalId("3789").performAsync(new EntityCallback<ConnectycubeUser>() {
    @Override
    public void onSuccess(ConnectycubeUser users, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

### Retrieve users by tags

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
val userTags = setOf("iphone")
ConnectyCube.getUsersByTags(userTags, {usersResult -> }, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
val pagedRequestBuilder = PagedRequestBuilder().apply {
    page = 1
    perPage = 50
}

val userTags: ArrayList<String> = ArrayList<String>().apply {
add("iphone")
}

val params = Bundle()

ConnectycubeUsers.getUsersByTags(userTags, pagedRequestBuilder, params)
.performAsync(object : EntityCallback<ArrayList<ConnectycubeUser>> {
override fun onSuccess(users: ArrayList<ConnectycubeUser>, args: Bundle) {

        }

        override fun onError(error: ResponseException) {

        }
    })

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
PagedRequestBuilder pagedRequestBuilder = new PagedRequestBuilder();
pagedRequestBuilder.setPage(1);
pagedRequestBuilder.setPerPage(50);

ArrayList<String> userTags = new ArrayList<>();
userTags.add("iphone");

Bundle params = new Bundle();

ConnectycubeUsers.getUsersByTags(userTags, pagedRequestBuilder, params).performAsync(new EntityCallback<ArrayList<ConnectycubeUser>>() {
    @Override
    public void onSuccess(ArrayList<ConnectycubeUser> users, Bundle args) {

    }

    @Override
    public void onError(ResponseException error) {

    }
});
````

</TabItem>
</Tabs>

## Delete user

A user can delete himself from the platform:

<Tabs syncKey="codeExamples">
<TabItem label='SDK v2 kotlin'>
```kotlin
ConnectyCube.deleteUser({}, { error -> })
```

</TabItem>
<TabItem label='SDK v1 kotlin (deprecated)'>
```kotlin
ConnectycubeUsers.deleteUser().performAsync(object : EntityCallback<Void?> {
    override fun onSuccess(result: Void?, params: Bundle) {

    }

    override fun onError(responseException: ResponseException) {

    }

})

````

</TabItem>
<TabItem label='SDK v1 java (deprecated)'>
```java
ConnectycubeUsers.deleteUser().performAsync(new EntityCallback<Void>() {
    @Override
    public void onSuccess(Void result, Bundle params) {

    }

    @Override
    public void onError(ResponseException responseException) {

    }
});
````

</TabItem>
</Tabs>
